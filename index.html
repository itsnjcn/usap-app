<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="A free, peer-to-peer, encrypted, open-source video calling for the web. No sign ups. No downloads.">
    <meta name="keywords" content="group video chat, video communication, multiparty video chat, video chat, webrtc, peer to peer, p2p">
    <meta name="application-name" content="Talk">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" href="icons/icon.png">
    <link rel="stylesheet" href="styles.css">
    <script defer src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script defer src="https://cdn.socket.io/4.7.5/socket.io.min.js" integrity="sha384-2huaZvOR9iDzHqslqwpR87isEmrfxqyWOF7hr7BY6KG0+hVKLoEXMPUJw3ynWuhO" crossorigin="anonymous"></script>
    <script defer src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script defer src="script.js"></script>
    <script defer src="webrtc.js"></script>
    <title>usap!</title>
</head>
<body>
    <section id="blanket"></section>
    <section id="videos"></section>
    <main id="app">
        <div id="appWrap" style="display:block;">
            <!-- MAIN PAGE -->
            <div id="intro" v-if="!callInitiated && !showChat && !showSettings">
                <img src="icons/fullb.png" loading="lazy" alt="usap! logo">
                <p id="center">Communicate, enjoy, and connect with usap!</p>
                <h2>Welcome! {User}!</h2>
                <p>
                    <label for="roomId">Room ID:</label>
                    <input id="roomId" v-model="roomId" placeholder="Enter a room id" maxlength="6">
                    <small>Room IDs generate automatically. Enter the ID to join your peers!</small>
                </p>
                <p>
                    <label for="yourName">Name:</label>
                    <input id="yourName" v-model="name" @keyup="updateName" placeholder="Enter your name">
                    <small>Leave this field blank to use your account's name instead.</small>
                </p>
                <div class="footer">
                    <button @click="initiateCall">Proceed ‚û°</button>
                    <a href="https://usap-app.njcn.dev/cdn-cgi/access/logout">Logout</a>
                </div>
                <footer>
                    <small>&copy 2024 <a href="https://njcn.dev/">njcn.dev</a>. All Rights Reserved</small>
                </footer>
            </div>
            <!-- CALL PAGE -->
            <div id="chatWrap" v-if="showChat">
                <div id="chats" ref="chatContainer">
                    <div class="chat" v-for="(chat, i) in chats" :key="i">
                        <span class="name">{{ chat.name }}</span>
                        <span class="date light"> &middot; {{ formatDate(chat.date) }}</span>
                        <div class="message" v-html="linkify(chat.message)"></div>
                    </div>
                    <div id="noChat" class="light" v-if="!chats.length"><small>No chat messages.</small></div>
                </div>
                <div id="composeBox">
                    <div id="placeholder" v-if="!typing.length">Type message...</div>
                    <div id="compose" contenteditable="true" @keydown.enter="sendChat" @input="edit" @paste="paste"></div>
                </div>
                <small class="light">Press enter to submit</small>
            </div>
            <div id="settings" v-if="showSettings">
                <div id="name" class="label">
                    <span>Name:</span>
                    <input placeholder="Enter your name" v-model="name" @keyup="updateNameAndPublish">
                </div>
                <hr class="separator">
                <div class="label">Camera üìπ</div>
                <div v-for="(videoDevice, i) in videoDevices" :key="videoDevice.deviceId">
                    <div :class="['link', 'indent', { active: selectedVideoDeviceId === videoDevice.deviceId }]" @click="changeCamera(videoDevice.deviceId)">
                        {{ videoDevice.label }}
                    </div>
                </div>
                <hr class="separator">
                <div class="label">Microphone üéôÔ∏è</div>
                <div v-for="(audioDevice, i) in audioDevices" :key="audioDevice.deviceId">
                    <div :class="['link', 'indent', { active: selectedAudioDeviceId === audioDevice.deviceId }]" @click="changeMicrophone(audioDevice.deviceId)">
                        {{ audioDevice.label }}
                    </div>
                </div>
                <hr class="separator">
                <div class="link" @click="copyURL">{{ copyText || "Copy room link üîó" }}</div>
                <hr class="separator">
                <div class="link" @click="toggleSelfVideoMirror">
                    Mirror / Unmirror
                    <small class="light">(self-view)</small>
                </div>
            </div>
            <div id="actionsWrap" v-if="callInitiated">
                <div id="actions">
                    <button :class="['icon-mic', { 'icon-mic-off': !audioEnabled }]" @click="audioToggle"></button>
                    <button :class="['icon-video', { 'icon-video-off': !videoEnabled }]" @click="videoToggle"></button>
                    <button :class="['icon-message-square', { active: showChat }]" @click="showChat = !showChat"></button>
                    <button v-if="!isMobileDevice" :class="['icon-monitor', { active: screenShareEnabled }]" @click="screenShareToggle"></button>
                    <a class="noDecoration icon-exit" @click="exit" href="https://usap-app.njcn.dev"></a>
                    <button :class="['icon-more-horizontal', { active: showSettings }]" @click="showSettings = !showSettings"></button>
                </div>
            </div>
        </div>
    </main>
</body>
</html>
